# vlxsam02 - Application Server

Servidor de aplicação SamurEye com Node.js 20 e aplicação completa.

## Scripts Disponíveis

### install-hard-reset.sh
Script completo de reset e reinstalação do servidor de aplicação.

**O que faz:**
- Remove aplicação existente completamente
- Reinstala Node.js 20 sem conflitos
- Baixa aplicação SamurEye do GitHub
- Configura ambiente de produção
- Faz build da aplicação
- Configura serviço systemd
- Inicia aplicação automaticamente

### debug-app.sh
Script de diagnóstico para problemas na aplicação.

**Uso:**
```bash
./debug-app.sh
```

**O que verifica:**
- Status do serviço systemd
- Logs de erro da aplicação
- Logs do sistema
- Conectividade PostgreSQL
- Arquivos e permissões
- Execução manual da aplicação

## Arquitetura

```
vlxsam02 (172.24.1.152)
├── Node.js 20.x
├── SamurEye Application
│   ├── Frontend (React + Vite)
│   ├── Backend (Express + TypeScript)
│   └── Database (PostgreSQL client)
├── systemd Service
└── Logs (/var/log/samureye/)
```

## Dependências

- **vlxsam03**: PostgreSQL deve estar funcionando primeiro
- **vlxsam01**: Gateway para SSL/proxy (opcional)
- **vlxsam04**: Collector agents (opcional)

## Configuração

### Ambiente de Produção (.env)
```bash
NODE_ENV=production
DATABASE_URL=postgresql://samureye:SamurEye2024!@172.24.1.153:5432/samureye
PORT=5000
SESSION_SECRET=<auto-generated>
ADMIN_EMAIL=admin@samureye.local
ADMIN_PASSWORD=SamurEye2024!
```

### Serviço systemd
- **Nome**: samureye-app.service
- **Usuário**: samureye
- **Logs**: /var/log/samureye/
- **Auto-restart**: Sim

## Resolução de Problemas

### Aplicação não inicia
```bash
# Verificar status
systemctl status samureye-app

# Verificar logs
journalctl -u samureye-app -f

# Diagnóstico completo
./debug-app.sh

# Testar manualmente
cd /opt/samureye/SamurEye
sudo -u samureye NODE_ENV=production node dist/index.js
```

### Erro de conexão PostgreSQL
```bash
# Testar conexão
PGPASSWORD="SamurEye2024!" psql -h 172.24.1.153 -U samureye -d samureye -c "SELECT version();"

# Verificar se vlxsam03 está funcionando
ping 172.24.1.153
telnet 172.24.1.153 5432
```

### Problemas de permissão
```bash
# Corrigir permissões
chown -R samureye:samureye /opt/samureye/
chown -R samureye:samureye /var/log/samureye/

# Reiniciar serviço
systemctl daemon-reload
systemctl restart samureye-app
```

## URLs de Acesso

Após configuração completa com vlxsam01:
- **Aplicação**: https://app.samureye.com.br
- **API**: https://api.samureye.com.br
- **Local**: http://172.24.1.152:5000 (desenvolvimento)

## Monitoramento

### Logs
- **Aplicação**: /var/log/samureye/app.log
- **Erros**: /var/log/samureye/error.log
- **Sistema**: journalctl -u samureye-app

### Status
```bash
systemctl status samureye-app
curl http://localhost:5000/api/health
```