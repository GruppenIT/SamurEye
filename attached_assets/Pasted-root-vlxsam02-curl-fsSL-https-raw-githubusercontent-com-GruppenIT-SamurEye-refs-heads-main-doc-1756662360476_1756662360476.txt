root@vlxsam02:~# curl -fsSL https://raw.githubusercontent.com/GruppenIT/SamurEye/refs/heads/main/docs/deployment/fix-vlxsam02-database-url.sh | sudo bash
ğŸ”§ CorreÃ§Ã£o DATABASE_URL vlxsam02
=================================
[14:41:05] ğŸ” Detectando IP do vlxsam03...
[14:41:05] ğŸ“ IP detectado via ping: 172.24.1.153
[14:41:05] ğŸ¯ IP final do vlxsam03: 172.24.1.153
[14:41:05] ğŸ”Œ Testando conectividade com 172.24.1.153:5432...
[14:41:05] âœ… Porta 5432 acessÃ­vel no IP 172.24.1.153
[14:41:05] ğŸ” Testando credenciais PostgreSQL...
[14:41:05] ğŸ§ª Testando: postgresql://samureye:SamurEye2024!@172.24.1.153:5432/samureye_prod
[14:41:05] âœ… SUCESSO!
[14:41:05] ğŸ¯ URL funcional: postgresql://samureye:SamurEye2024!@172.24.1.153:5432/samureye_prod
[14:41:05] ğŸ“ Trabalhando em: /opt/samureye/SamurEye
[14:41:05] ğŸ’¾ Backup criado: .env.backup.144105
[14:41:05] ğŸ“ Atualizando DATABASE_URL no .env...
[14:41:05] âœ… DATABASE_URL atualizada no .env
[14:41:05] ğŸ“‹ Nova configuraÃ§Ã£o .env:
DATABASE_URL=***
[14:41:05] ğŸ—ƒï¸ Sincronizando schema do banco...
[14:41:05] ğŸ”„ Executando npm run db:push...
[14:41:06] âœ… Schema sincronizado com sucesso
[14:41:06] ğŸ”„ Reiniciando aplicaÃ§Ã£o SamurEye...
[14:41:22] âœ… AplicaÃ§Ã£o reiniciada com sucesso
[14:41:22] ğŸŒ Testando aplicaÃ§Ã£o...
[14:41:32] âœ… AplicaÃ§Ã£o respondendo localmente
[14:41:32] ğŸ“ Logs recentes da aplicaÃ§Ã£o:
Aug 31 14:41:18 vlxsam02 samureye-app[369922]: 2:41:18 PM [express] serving on port 5000
Aug 31 14:41:22 vlxsam02 samureye-app[369922]: WebSocket client connected
Aug 31 14:41:22 vlxsam02 samureye-app[369922]: WebSocket client connected
Aug 31 14:41:32 vlxsam02 samureye-app[369922]: Collector heartbeat: vlxsam04 (vlxsam04) - Status: active
Aug 31 14:41:32 vlxsam02 samureye-app[369922]: 2:41:32 PM [express] GET /api/admin/me 401 in 2ms :: {"isAuthenticated":false,"message":"Not authentâ€¦

[14:41:33] âœ… CorreÃ§Ã£o DATABASE_URL finalizada!

ğŸ“‹ RESUMO:
   â€¢ IP vlxsam03: 172.24.1.153
   â€¢ DATABASE_URL: postgresql://samureye:SamurEye2024!@172.24.1.153:5432/samureye_prod
   â€¢ Schema sincronizado
   â€¢ AplicaÃ§Ã£o reiniciada

ğŸ”— Testar interface:
   https://app.samureye.com.br/admin/collectors

ğŸ“ Monitorar logs:
   journalctl -u samureye-app -f
root@vlxsam02:~# curl -fsSL https://raw.githubusercontent.com/GruppenIT/SamurEye/refs/heads/main/docs/deployment/vlxsam02/install-fixed.sh | sudo bash
ğŸš€ SAMUREYE vlxsam02 - INSTALAÃ‡ÃƒO CORRIGIDA
===========================================
âœ… DetecÃ§Ã£o automÃ¡tica de diretÃ³rio da aplicaÃ§Ã£o
âœ… DATABASE_URL com IP correto (172.24.1.153)
âœ… AdminLayout integrado para Ã¡rea administrativa
âœ… CorreÃ§Ã£o do erro TenantProvider

[2025-08-31 14:44:28] ğŸ” Detectando IP do vlxsam03...
[2025-08-31 14:44:28] ğŸ“ IP detectado via ping: 172.24.1.153
[2025-08-31 14:44:28] ğŸ”Œ Testando conectividade PostgreSQL 172.24.1.153:5432...
[2025-08-31 14:44:28] ğŸ” Testando credenciais PostgreSQL...
[2025-08-31 14:44:28] âœ… URL funcional encontrada!
[2025-08-31 14:44:28] ğŸ“¦ Instalando dependÃªncias do sistema...
Hit:1 https://deb.nodesource.com/node_20.x nodistro InRelease
Hit:2 http://archive.ubuntu.com/ubuntu noble InRelease
Get:3 http://security.ubuntu.com/ubuntu noble-security InRelease [126 kB]
Get:4 http://archive.ubuntu.com/ubuntu noble-updates InRelease [126 kB]
Get:5 http://archive.ubuntu.com/ubuntu noble-backports InRelease [126 kB]
Get:6 http://archive.ubuntu.com/ubuntu noble-updates/main amd64 Packages [1,379 kB]
Get:7 http://security.ubuntu.com/ubuntu noble-security/main amd64 Components [21.5 kB]
Get:8 http://security.ubuntu.com/ubuntu noble-security/restricted amd64 Components [212 B]
Get:9 http://security.ubuntu.com/ubuntu noble-security/universe amd64 Components [52.3 kB]
Get:10 http://security.ubuntu.com/ubuntu noble-security/multiverse amd64 Components [212 B]
Get:11 http://archive.ubuntu.com/ubuntu noble-updates/main amd64 Components [175 kB]
Get:12 http://archive.ubuntu.com/ubuntu noble-updates/restricted amd64 Components [212 B]
Get:13 http://archive.ubuntu.com/ubuntu noble-updates/universe amd64 Packages [1,471 kB]
Get:14 http://archive.ubuntu.com/ubuntu noble-updates/universe amd64 Components [377 kB]
Get:15 http://archive.ubuntu.com/ubuntu noble-updates/multiverse amd64 Components [940 B]
Get:16 http://archive.ubuntu.com/ubuntu noble-backports/main amd64 Components [7,072 B]
Get:17 http://archive.ubuntu.com/ubuntu noble-backports/restricted amd64 Components [216 B]
Get:18 http://archive.ubuntu.com/ubuntu noble-backports/universe amd64 Components [19.2 kB]
Get:19 http://archive.ubuntu.com/ubuntu noble-backports/multiverse amd64 Components [212 B]
Fetched 3,882 kB in 3s (1,542 kB/s)
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
1 package can be upgraded. Run 'apt list --upgradable' to see it.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
curl is already the newest version (8.5.0-2ubuntu10.6).
wget is already the newest version (1.21.4-1ubuntu4.1).
gnupg is already the newest version (2.4.4-2ubuntu17.3).
software-properties-common is already the newest version (0.99.49.3).
0 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
[2025-08-31 14:44:35] ğŸ“ Configurando diretÃ³rio da aplicaÃ§Ã£o...
[2025-08-31 14:44:35] ğŸ”„ Atualizando repositÃ³rio existente...
fatal: detected dubious ownership in repository at '/opt/samureye/SamurEye'
To add an exception for this directory, call:

        git config --global --add safe.directory /opt/samureye/SamurEye
root@vlxsam02:~# journalctl -u samureye-app -f
Aug 31 14:41:32 vlxsam02 samureye-app[369922]: Collector heartbeat: vlxsam04 (vlxsam04) - Status: active
Aug 31 14:41:32 vlxsam02 samureye-app[369922]: 2:41:32 PM [express] GET /api/admin/me 401 in 2ms :: {"isAuthenticated":false,"message":"Not authentâ€¦
Aug 31 14:41:45 vlxsam02 samureye-app[369922]: Collector heartbeat: vlxsam04 (vlxsam04) - Status: active
Aug 31 14:42:15 vlxsam02 samureye-app[369922]: Collector heartbeat: vlxsam04 (vlxsam04) - Status: active
Aug 31 14:42:24 vlxsam02 samureye-app[369922]: Collector heartbeat: vlxsam04 (vlxsam04) - Status: online
Aug 31 14:42:45 vlxsam02 samureye-app[369922]: Collector heartbeat: vlxsam04 (vlxsam04) - Status: active
Aug 31 14:43:15 vlxsam02 samureye-app[369922]: Collector heartbeat: vlxsam04 (vlxsam04) - Status: active
Aug 31 14:43:45 vlxsam02 samureye-app[369922]: Collector heartbeat: vlxsam04 (vlxsam04) - Status: active
Aug 31 14:44:15 vlxsam02 samureye-app[369922]: Collector heartbeat: vlxsam04 (vlxsam04) - Status: active
Aug 31 14:44:45 vlxsam02 samureye-app[369922]: Collector heartbeat: vlxsam04 (vlxsam04) - Status: active
^C
root@vlxsam02:~#