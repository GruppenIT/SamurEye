root@vlxsam02:/opt/samureye/SamurEye# curl -fsSL https://raw.githubusercontent.com/GruppenIT/SamurEye/refs/heads/main/docs/deployment/test-endpoint-direct.sh | bash
ğŸ§ª TESTE DIRETO DO ENDPOINT - collector-api/journeys/pending
===========================================================
ğŸ” Collector ID: b6d6c21f...da951b22
ğŸ” Token: b6d6c21f...da951b22

ğŸ“‹ Teste 1: Chamada direta ao endpoint...
URL: https://api.samureye.com.br/collector-api/journeys/pending?collector_id=b6d6c21f-cf49-43a0-ba22-68e3da951b22&token=b6d6c21f-cf49-43a0-ba22-68e3da951b22
HTTP Code: 200
Response: []

ğŸ“‹ Teste 2: Verificando dados que o endpoint deveria retornar...

ğŸ” Collector no banco:
                  id                  |   name   | has_token | token_valid
--------------------------------------+----------+-----------+-------------
 b6d6c21f-cf49-43a0-ba22-68e3da951b22 | vlxsam04 | t         | t
(1 row)


ğŸ” ExecuÃ§Ãµes pendentes (o que o endpoint deveria retornar):
 id | journey_id | collector_id | status | created_at | journey_name
----+------------+--------------+--------+------------+--------------
(0 rows)


ğŸ” Simulando lÃ³gica do endpoint:
1. Buscar collector por enrollment_token...
                  id                  |   name   | status
--------------------------------------+----------+--------
 b6d6c21f-cf49-43a0-ba22-68e3da951b22 | vlxsam04 | FOUND
(1 row)


2. Buscar execuÃ§Ãµes pendentes...
 id | journey_id | status | execution_number | scheduled_for | started_at | completed_at | duration_seconds | results | error_message | collector_id | metadata | created_at | updated_at
----+------------+--------+------------------+---------------+------------+--------------+------------------+---------+---------------+--------------+----------+------------+------------
(0 rows)


3. Filtrar execuÃ§Ãµes para este collector...
 id | journey_id | status | execution_number | scheduled_for | started_at | completed_at | duration_seconds | results | error_message | collector_id | metadata | created_at | updated_at
----+------------+--------+------------------+---------------+------------+--------------+------------------+---------+---------------+--------------+----------+------------+------------
(0 rows)


ğŸ“‹ Teste 3: ForÃ§ando criaÃ§Ã£o de execuÃ§Ã£o correta...
Jornada encontrada: 43c05c11-557f-4233-a195-137758b64036
DELETE 0
âœ… Nova execuÃ§Ã£o criada!
Verificando...
 total_queued
--------------
            0
(1 row)


ğŸ“‹ Teste 4: Testando endpoint apÃ³s correÃ§Ã£o...
HTTP Code: 200
Response: []

ğŸ¯ ANÃLISE:
âš ï¸ Endpoint OK mas sem execuÃ§Ãµes pendentes
root@vlxsam02:/opt/samureye/SamurEye#