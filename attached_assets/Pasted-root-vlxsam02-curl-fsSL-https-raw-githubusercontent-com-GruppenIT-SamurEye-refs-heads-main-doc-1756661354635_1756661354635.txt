root@vlxsam02:~# curl -fsSL https://raw.githubusercontent.com/GruppenIT/SamurEye/refs/heads/main/docs/deployment/fix-vlxsam02-database-url.sh | sudo bash
ğŸ”§ CorreÃ§Ã£o DATABASE_URL vlxsam02
=================================
[14:27:02] ğŸ” Detectando IP do vlxsam03...
[14:27:02] ğŸ“ IP detectado via ping: 172.24.1.153
[14:27:02] ğŸ¯ IP final do vlxsam03: 172.24.1.153
[14:27:02] ğŸ”Œ Testando conectividade com 172.24.1.153:5432...
[14:27:02] âœ… Porta 5432 acessÃ­vel no IP 172.24.1.153
[14:27:02] ğŸ” Testando credenciais PostgreSQL...
[14:27:02] ğŸ§ª Testando: postgresql://samureye:SamurEye2024!@172.24.1.153:5432/samureye_prod
[14:27:03] âœ… SUCESSO!
[14:27:03] ğŸ¯ URL funcional: postgresql://samureye:SamurEye2024!@172.24.1.153:5432/samureye_prod
[14:27:03] ğŸ“ Trabalhando em: /opt/samureye/SamurEye
[14:27:03] ğŸ’¾ Backup criado: .env.backup.142703
[14:27:03] ğŸ“ Atualizando DATABASE_URL no .env...
[14:27:03] âœ… DATABASE_URL atualizada no .env
[14:27:03] ğŸ“‹ Nova configuraÃ§Ã£o .env:
DATABASE_URL=***
[14:27:03] ğŸ—ƒï¸ Sincronizando schema do banco...
[14:27:03] ğŸ”„ Executando npm run db:push...
[14:27:03] âœ… Schema sincronizado com sucesso
[14:27:03] ğŸ”„ Reiniciando aplicaÃ§Ã£o SamurEye...
[14:27:20] âœ… AplicaÃ§Ã£o reiniciada com sucesso
[14:27:20] ğŸŒ Testando aplicaÃ§Ã£o...
[14:27:30] âœ… AplicaÃ§Ã£o respondendo localmente
[14:27:30] ğŸ“ Logs recentes da aplicaÃ§Ã£o:
Aug 31 14:27:16 vlxsam02 samureye-app[369744]: 2:27:16 PM [express] serving on port 5000
Aug 31 14:27:19 vlxsam02 samureye-app[369744]: Collector heartbeat: vlxsam04 (vlxsam04) - Status: active
Aug 31 14:27:19 vlxsam02 samureye-app[369744]: WebSocket client connected
Aug 31 14:27:19 vlxsam02 samureye-app[369744]: WebSocket client connected
Aug 31 14:27:30 vlxsam02 samureye-app[369744]: 2:27:30 PM [express] GET /api/admin/me 401 in 2ms :: {"isAuthenticated":false,"message":"Not authentâ€¦

[14:27:30] âœ… CorreÃ§Ã£o DATABASE_URL finalizada!

ğŸ“‹ RESUMO:
   â€¢ IP vlxsam03: 172.24.1.153
   â€¢ DATABASE_URL: postgresql://samureye:SamurEye2024!@172.24.1.153:5432/samureye_prod
   â€¢ Schema sincronizado
   â€¢ AplicaÃ§Ã£o reiniciada

ğŸ”— Testar interface:
   https://app.samureye.com.br/admin/collectors

ğŸ“ Monitorar logs:
   journalctl -u samureye-app -f
root@vlxsam02:~#