root@vlxsam03:~# curl -fsSL https://raw.githubusercontent.com/GruppenIT/SamurEye/main/docs/deployment/vlxsam03/install.sh | bash
[15:23:18] ğŸš€ Iniciando instalaÃ§Ã£o vlxsam03 - Database/Services Server
[15:23:18] Servidor: 172.24.1.153
[15:23:18] Data Directory: /opt/data
[15:23:18] ğŸ“¦ Atualizando sistema base...
Hit:1 https://packages.grafana.com/oss/deb stable InRelease
Hit:2 http://security.ubuntu.com/ubuntu noble-security InRelease
Hit:3 http://archive.ubuntu.com/ubuntu noble InRelease
Hit:4 http://archive.ubuntu.com/ubuntu noble-updates InRelease
Hit:5 http://archive.ubuntu.com/ubuntu noble-backports InRelease
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
All packages are up to date.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Calculating upgrade... Done
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
curl is already the newest version (8.5.0-2ubuntu10.6).
wget is already the newest version (1.21.4-1ubuntu4.1).
gnupg is already the newest version (2.4.4-2ubuntu17.3).
software-properties-common is already the newest version (0.99.49.3).
apt-transport-https is already the newest version (2.8.3).
ca-certificates is already the newest version (20240203).
lsb-release is already the newest version (12.0-2).
jq is already the newest version (1.7.1-3ubuntu0.24.04.1).
htop is already the newest version (3.3.0-4build1).
iotop is already the newest version (0.6-42-ga14256a-0.2build1).
netcat-openbsd is already the newest version (1.226-1ubuntu2).
redis-tools is already the newest version (5:7.0.15-1ubuntu0.24.04.1).
postgresql-client-16 is already the newest version (16.9-0ubuntu0.24.04.1).
postgresql-client-16 set to manually installed.
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
[15:23:21] Sistema base atualizado
[15:23:21] ğŸ‘¤ Configurando usuÃ¡rios e diretÃ³rios...
[15:23:21] UsuÃ¡rios e diretÃ³rios configurados
[15:23:21] ğŸ”´ Instalando Redis...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
redis-server is already the newest version (5:7.0.15-1ubuntu0.24.04.1).
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Synchronizing state of redis-server.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.
Executing: /usr/lib/systemd/systemd-sysv-install enable redis-server
Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe.
[15:23:27] âœ… Redis configurado e testado com sucesso
[15:23:27] Redis configurado e iniciado
[15:23:27] ğŸ˜ Instalando PostgreSQL 16...
[15:23:27] WARNING: ğŸ§¹ Executando limpeza preventiva completa do PostgreSQL...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Note, selecting 'postgresql-powa' for glob 'postgresql*'
Note, selecting 'postgresql-16-asn1oid' for glob 'postgresql*'
Note, selecting 'postgresql-13-auto-failover' for glob 'postgresql*'
Note, selecting 'postgresql-16-prefix' for glob 'postgresql*'
Note, selecting 'postgresql-9.1' for glob 'postgresql*'
Note, selecting 'postgresql-14-auto-failover' for glob 'postgresql*'
Note, selecting 'postgresql-16-unit' for glob 'postgresql*'
Note, selecting 'postgresql-16-postgis-scripts' for glob 'postgresql*'
Note, selecting 'postgresql-16-pllua' for glob 'postgresql*'
Note, selecting 'postgresql-16-pldebugger' for glob 'postgresql*'
Note, selecting 'postgresql-server-dev-all' for glob 'postgresql*'
Note, selecting 'postgresql-16-partman' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgmp' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgq3' for glob 'postgresql*'
Note, selecting 'postgresql-16-plsh' for glob 'postgresql*'
Note, selecting 'postgresql-16-squeeze' for glob 'postgresql*'
Note, selecting 'postgresql-16-powa' for glob 'postgresql*'
Note, selecting 'postgresql-16' for glob 'postgresql*'
Note, selecting 'postgresql-16-dirtyread' for glob 'postgresql*'
Note, selecting 'postgresql-16-rational' for glob 'postgresql*'
Note, selecting 'postgresql-contrib' for glob 'postgresql*'
Note, selecting 'postgresql-16-decoderbufs' for glob 'postgresql*'
Note, selecting 'postgresql-pgrouting-scripts' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgrouting-scripts' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgtap' for glob 'postgresql*'
Note, selecting 'postgresql-16-tablelog' for glob 'postgresql*'
Note, selecting 'postgresql-16-plproxy' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgq-node' for glob 'postgresql*'
Note, selecting 'postgresql-16-snakeoil' for glob 'postgresql*'
Note, selecting 'postgresql-11-auto-failover' for glob 'postgresql*'
Note, selecting 'postgresql-16-set-user' for glob 'postgresql*'
Note, selecting 'postgresql-12-auto-failover' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgvector' for glob 'postgresql*'
Note, selecting 'postgresql-16-orafce' for glob 'postgresql*'
Note, selecting 'postgresql-16-extra-window-functions' for glob 'postgresql*'
Note, selecting 'postgresql-all' for glob 'postgresql*'
Note, selecting 'postgresql-plprofiler' for glob 'postgresql*'
Note, selecting 'postgresql-autodoc' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgsphere' for glob 'postgresql*'
Note, selecting 'postgresql-16-periods' for glob 'postgresql*'
Note, selecting 'postgresql-doc' for glob 'postgresql*'
Note, selecting 'postgresql-16-tdigest' for glob 'postgresql*'
Note, selecting 'postgresql-plpython3-16' for glob 'postgresql*'
Note, selecting 'postgresql-plpython3' for glob 'postgresql*'
Note, selecting 'postgresql-16-pg-fact-loader' for glob 'postgresql*'
Note, selecting 'postgresql-16-semver' for glob 'postgresql*'
Note, selecting 'postgresql-postgis-java' for glob 'postgresql*'
Note, selecting 'postgresql-16-preprepare' for glob 'postgresql*'
Note, selecting 'postgresql-q3c' for glob 'postgresql*'
Note, selecting 'postgresql-16-postgis-3' for glob 'postgresql*'
Note, selecting 'postgresql-plr' for glob 'postgresql*'
Note, selecting 'postgresql-comparator' for glob 'postgresql*'
Note, selecting 'postgresql-16-jsquery' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgrouting' for glob 'postgresql*'
Note, selecting 'postgresql-16-pg-failover-slots' for glob 'postgresql*'
Note, selecting 'postgresql-statviz' for glob 'postgresql*'
Note, selecting 'postgresql-16-mysql-fdw' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgpool2' for glob 'postgresql*'
Note, selecting 'postgresql-16-bgw-replstatus' for glob 'postgresql*'
Note, selecting 'postgresql-16-first-last-agg' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgagent' for glob 'postgresql*'
Note, selecting 'postgresql-16-mimeo' for glob 'postgresql*'
Note, selecting 'postgresql-16-jit-llvm' for glob 'postgresql*'
Note, selecting 'postgresql-server-dev-16' for glob 'postgresql*'
Note, selecting 'postgresql-16-pg-gvm' for glob 'postgresql*'
Note, selecting 'postgresql-filedump' for glob 'postgresql*'
Note, selecting 'postgresql-16-statviz' for glob 'postgresql*'
Note, selecting 'postgresql-16-plpgsql-check' for glob 'postgresql*'
Note, selecting 'postgresql-ogr-fdw' for glob 'postgresql*'
Note, selecting 'postgresql-16-omnidb' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgl-ddl-deploy' for glob 'postgresql*'
Note, selecting 'postgresql-contrib-16' for glob 'postgresql*'
Note, selecting 'postgresql-client-16' for glob 'postgresql*'
Note, selecting 'postgresql-16-wal2json' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgrouting-doc' for glob 'postgresql*'
Note, selecting 'postgresql-16-debversion' for glob 'postgresql*'
Note, selecting 'postgresql-doc-16' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgauditlogtofile' for glob 'postgresql*'
Note, selecting 'postgresql-16-pg-catcheck' for glob 'postgresql*'
Note, selecting 'postgresql-pgsphere' for glob 'postgresql*'
Note, selecting 'postgresql-16-plprofiler' for glob 'postgresql*'
Note, selecting 'postgresql-plperl-16' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgmemcache' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgextwlist' for glob 'postgresql*'
Note, selecting 'postgresql-16-pg-track-settings' for glob 'postgresql*'
Note, selecting 'postgresql-16-h3' for glob 'postgresql*'
Note, selecting 'postgresql-16-rdkit' for glob 'postgresql*'
Note, selecting 'postgresql-16-londiste-sql' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgpcre' for glob 'postgresql*'
Note, selecting 'postgresql-postgis' for glob 'postgresql*'
Note, selecting 'postgresql-common' for glob 'postgresql*'
Note, selecting 'postgresql-16-pointcloud' for glob 'postgresql*'
Note, selecting 'postgresql-16-repack' for glob 'postgresql*'
Note, selecting 'postgresql-16-pg-wait-sampling' for glob 'postgresql*'
Note, selecting 'postgresql-16-age' for glob 'postgresql*'
Note, selecting 'postgresql-ip4r' for glob 'postgresql*'
Note, selecting 'postgresql-16-postgis' for glob 'postgresql*'
Note, selecting 'postgresql-client-common' for glob 'postgresql*'
Note, selecting 'postgresql-16-hll' for glob 'postgresql*'
Note, selecting 'postgresql-16-repmgr' for glob 'postgresql*'
Note, selecting 'postgresql-16-icu-ext' for glob 'postgresql*'
Note, selecting 'postgresql-pltcl-16' for glob 'postgresql*'
Note, selecting 'postgresql-16-ogr-fdw' for glob 'postgresql*'
Note, selecting 'postgresql-16-cron' for glob 'postgresql*'
Note, selecting 'postgresql-pgrouting' for glob 'postgresql*'
Note, selecting 'postgresql-16-q3c' for glob 'postgresql*'
Note, selecting 'postgresql' for glob 'postgresql*'
Note, selecting 'postgresql-16-plr' for glob 'postgresql*'
Note, selecting 'postgresql-16-rum' for glob 'postgresql*'
Note, selecting 'postgresql-client' for glob 'postgresql*'
Note, selecting 'postgresql-16-pg-stat-kcache' for glob 'postgresql*'
Note, selecting 'postgresql-16-show-plans' for glob 'postgresql*'
Note, selecting 'postgresql-15-auto-failover' for glob 'postgresql*'
Note, selecting 'postgresql-16-auto-failover' for glob 'postgresql*'
Note, selecting 'postgresql-16-ip4r' for glob 'postgresql*'
Note, selecting 'postgresql-16-slony1' for glob 'postgresql*'
Note, selecting 'postgresql-16-pglogical-ticker' for glob 'postgresql*'
Note, selecting 'postgresql-postgis-scripts' for glob 'postgresql*'
Note, selecting 'postgresql-16-postgis-3-scripts' for glob 'postgresql*'
Note, selecting 'postgresql-16-slony1-2' for glob 'postgresql*'
Note, selecting 'postgresql-pltcl' for glob 'postgresql*'
Note, selecting 'postgresql-16-prioritize' for glob 'postgresql*'
Note, selecting 'postgresql-16-hypopg' for glob 'postgresql*'
Note, selecting 'postgresql-plperl' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgfincore' for glob 'postgresql*'
Note, selecting 'postgresql-16-toastinfo' for glob 'postgresql*'
Note, selecting 'postgresql-16-pgaudit' for glob 'postgresql*'
Note, selecting 'postgresql-16-pglogical' for glob 'postgresql*'
Note, selecting 'postgresql-pgmp' for glob 'postgresql*'
Note, selecting 'postgresql-16-pg-checksums' for glob 'postgresql*'
Note, selecting 'postgresql-16-similarity' for glob 'postgresql*'
Note, selecting 'postgresql-16-credcheck' for glob 'postgresql*'
Note, selecting 'postgresql-16-pg-qualstats' for glob 'postgresql*'
Note, selecting 'postgresql-pgtap' for glob 'postgresql*'
Note, selecting 'postgresql-16-tds-fdw' for glob 'postgresql*'
Note, selecting 'postgresql-16-numeral' for glob 'postgresql*'
Package 'postgresql-pgmp' is not installed, so not removed
Note, selecting 'postgresql-16' instead of 'postgresql-16-jit-llvm'
Note, selecting 'postgresql-16' instead of 'postgresql-contrib-16'
Package 'postgresql-9.1' is not installed, so not removed
Note, selecting 'postgresql-plperl-16' instead of 'postgresql-plperl'
Note, selecting 'postgresql-plpython3-16' instead of 'postgresql-plpython3'
Note, selecting 'postgresql-pltcl-16' instead of 'postgresql-pltcl'
Note, selecting 'postgresql-16-pgsphere' instead of 'postgresql-pgsphere'
Note, selecting 'postgresql-16-q3c' instead of 'postgresql-q3c'
Note, selecting 'postgresql-16-plr' instead of 'postgresql-plr'
Package 'postgresql-postgis-java' is not installed, so not removed
Note, selecting 'postgresql-16-pgtap' instead of 'postgresql-pgtap'
Package 'postgresql-11-auto-failover' is not installed, so not removed
Package 'postgresql-12-auto-failover' is not installed, so not removed
Package 'postgresql-13-auto-failover' is not installed, so not removed
Package 'postgresql-14-auto-failover' is not installed, so not removed
Package 'postgresql-15-auto-failover' is not installed, so not removed
Note, selecting 'postgresql-16-statviz' instead of 'postgresql-statviz'
Note, selecting 'pgagent' instead of 'postgresql-16-pgagent'
Note, selecting 'postgresql-16-plprofiler' instead of 'postgresql-plprofiler'
Note, selecting 'postgresql-16-ip4r' instead of 'postgresql-ip4r'
Note, selecting 'postgresql-16-ogr-fdw' instead of 'postgresql-ogr-fdw'
Note, selecting 'postgresql-16-postgis-3' instead of 'postgresql-16-postgis'
Note, selecting 'postgresql-16-postgis-3-scripts' instead of 'postgresql-16-postgis-scripts'
Note, selecting 'postgresql-16-powa' instead of 'postgresql-powa'
Note, selecting 'postgresql-16-slony1-2' instead of 'postgresql-16-slony1'
Package 'postgresql-client' is not installed, so not removed
Package 'postgresql-doc-16' is not installed, so not removed
Package 'postgresql' is not installed, so not removed
Package 'postgresql-doc' is not installed, so not removed
Package 'postgresql-server-dev-all' is not installed, so not removed
Package 'postgresql-plperl-16' is not installed, so not removed
Package 'postgresql-plpython3-16' is not installed, so not removed
Package 'postgresql-pltcl-16' is not installed, so not removed
Package 'postgresql-pgrouting' is not installed, so not removed
Package 'postgresql-comparator' is not installed, so not removed
Package 'postgresql-filedump' is not installed, so not removed
Package 'postgresql-postgis' is not installed, so not removed
Package 'postgresql-16-auto-failover' is not installed, so not removed
Package 'postgresql-16-age' is not installed, so not removed
Package 'postgresql-16-asn1oid' is not installed, so not removed
Package 'postgresql-16-bgw-replstatus' is not installed, so not removed
Package 'postgresql-16-credcheck' is not installed, so not removed
Package 'postgresql-16-cron' is not installed, so not removed
Package 'postgresql-16-debversion' is not installed, so not removed
Package 'postgresql-16-decoderbufs' is not installed, so not removed
Package 'postgresql-16-dirtyread' is not installed, so not removed
Package 'postgresql-16-extra-window-functions' is not installed, so not removed
Package 'postgresql-16-first-last-agg' is not installed, so not removed
Package 'postgresql-16-h3' is not installed, so not removed
Package 'postgresql-16-hll' is not installed, so not removed
Package 'postgresql-16-hypopg' is not installed, so not removed
Package 'postgresql-16-icu-ext' is not installed, so not removed
Package 'postgresql-16-ip4r' is not installed, so not removed
Package 'postgresql-16-jsquery' is not installed, so not removed
Package 'postgresql-16-londiste-sql' is not installed, so not removed
Package 'postgresql-16-pgq-node' is not installed, so not removed
Package 'postgresql-16-mimeo' is not installed, so not removed
Package 'postgresql-16-mysql-fdw' is not installed, so not removed
Package 'postgresql-16-numeral' is not installed, so not removed
Package 'postgresql-16-ogr-fdw' is not installed, so not removed
Package 'postgresql-16-omnidb' is not installed, so not removed
Package 'postgresql-16-orafce' is not installed, so not removed
Package 'postgresql-16-partman' is not installed, so not removed
Package 'postgresql-16-periods' is not installed, so not removed
Package 'postgresql-16-pg-catcheck' is not installed, so not removed
Package 'postgresql-16-pg-checksums' is not installed, so not removed
Package 'postgresql-16-pg-fact-loader' is not installed, so not removed
Package 'postgresql-16-pg-failover-slots' is not installed, so not removed
Package 'postgresql-16-pg-gvm' is not installed, so not removed
Package 'postgresql-16-pg-qualstats' is not installed, so not removed
Package 'postgresql-16-pg-stat-kcache' is not installed, so not removed
Package 'postgresql-16-pg-track-settings' is not installed, so not removed
Package 'postgresql-16-pg-wait-sampling' is not installed, so not removed
Package 'postgresql-16-pgaudit' is not installed, so not removed
Package 'postgresql-16-pgauditlogtofile' is not installed, so not removed
Package 'postgresql-16-pgextwlist' is not installed, so not removed
Package 'postgresql-16-pgfincore' is not installed, so not removed
Package 'postgresql-16-pgl-ddl-deploy' is not installed, so not removed
Package 'postgresql-16-pglogical' is not installed, so not removed
Package 'postgresql-16-pglogical-ticker' is not installed, so not removed
Package 'postgresql-16-pgmemcache' is not installed, so not removed
Package 'postgresql-16-pgmp' is not installed, so not removed
Package 'postgresql-16-pgpcre' is not installed, so not removed
Package 'postgresql-16-pgpool2' is not installed, so not removed
Package 'postgresql-16-pgq3' is not installed, so not removed
Package 'postgresql-16-pgrouting' is not installed, so not removed
Package 'postgresql-16-pgrouting-scripts' is not installed, so not removed
Package 'postgresql-16-pgrouting-doc' is not installed, so not removed
Package 'postgresql-16-pgsphere' is not installed, so not removed
Package 'postgresql-16-pgtap' is not installed, so not removed
Package 'postgresql-16-pgvector' is not installed, so not removed
Package 'postgresql-16-pldebugger' is not installed, so not removed
Package 'postgresql-16-pllua' is not installed, so not removed
Package 'postgresql-16-plpgsql-check' is not installed, so not removed
Package 'postgresql-16-plprofiler' is not installed, so not removed
Package 'postgresql-16-plproxy' is not installed, so not removed
Package 'postgresql-16-plr' is not installed, so not removed
Package 'postgresql-16-plsh' is not installed, so not removed
Package 'postgresql-16-pointcloud' is not installed, so not removed
Package 'postgresql-16-postgis-3' is not installed, so not removed
Package 'postgresql-16-postgis-3-scripts' is not installed, so not removed
Package 'postgresql-16-powa' is not installed, so not removed
Package 'postgresql-16-prefix' is not installed, so not removed
Package 'postgresql-16-preprepare' is not installed, so not removed
Package 'postgresql-16-prioritize' is not installed, so not removed
Package 'postgresql-16-q3c' is not installed, so not removed
Package 'postgresql-16-rational' is not installed, so not removed
Package 'postgresql-16-rdkit' is not installed, so not removed
Package 'postgresql-16-repack' is not installed, so not removed
Package 'postgresql-16-repmgr' is not installed, so not removed
Package 'postgresql-16-rum' is not installed, so not removed
Package 'postgresql-16-semver' is not installed, so not removed
Package 'postgresql-16-set-user' is not installed, so not removed
Package 'postgresql-16-show-plans' is not installed, so not removed
Package 'postgresql-16-similarity' is not installed, so not removed
Package 'postgresql-16-slony1-2' is not installed, so not removed
Package 'postgresql-16-snakeoil' is not installed, so not removed
Package 'postgresql-16-squeeze' is not installed, so not removed
Package 'postgresql-16-statviz' is not installed, so not removed
Package 'postgresql-16-tablelog' is not installed, so not removed
Package 'postgresql-16-tdigest' is not installed, so not removed
Package 'postgresql-16-tds-fdw' is not installed, so not removed
Package 'postgresql-16-toastinfo' is not installed, so not removed
Package 'postgresql-16-unit' is not installed, so not removed
Package 'postgresql-16-wal2json' is not installed, so not removed
Package 'postgresql-all' is not installed, so not removed
Package 'postgresql-autodoc' is not installed, so not removed
Package 'postgresql-pgrouting-scripts' is not installed, so not removed
Package 'postgresql-postgis-scripts' is not installed, so not removed
Package 'postgresql-server-dev-16' is not installed, so not removed
The following packages were automatically installed and are no longer required:
  libcommon-sense-perl libjson-perl libjson-xs-perl libllvm17t64 libpq5 libtypes-serialiser-perl ssl-cert
Use 'apt autoremove' to remove them.
The following packages will be REMOVED:
  postgresql-16* postgresql-client-16* postgresql-client-common* postgresql-common* postgresql-contrib*
0 upgraded, 0 newly installed, 5 to remove and 0 not upgraded.
After this operation, 50.4 MB disk space will be freed.
(Reading database ... 140168 files and directories currently installed.)
Removing postgresql-contrib (16+257build1.1) ...
Removing postgresql-16 (16.9-0ubuntu0.24.04.1) ...
update-alternatives: warning: forcing reinstallation of alternative /usr/share/postgresql/16/man/man1/psql.1.gz because link group psql.1.gz is broken
Use of uninitialized value $data_directory in concatenation (.) or string at /usr/share/perl5/PgCommon.pm line 286.
Use of uninitialized value $data_directory in concatenation (.) or string at /usr/share/perl5/PgCommon.pm line 286.
Use of uninitialized value $data_directory in concatenation (.) or string at /usr/share/perl5/PgCommon.pm line 286.
Error: Invalid data directory for cluster 16 main
Removing postgresql-client-16 (16.9-0ubuntu0.24.04.1) ...
Removing postgresql-common (257build1.1) ...
Removing 'diversion of /usr/bin/pg_config to /usr/bin/pg_config.libpq-dev by postgresql-common'
Removing postgresql-client-common (257build1.1) ...
Processing triggers for man-db (2.12.0-4build2) ...
(Reading database ... 138284 files and directories currently installed.)
Purging configuration files for postgresql-client-common (257build1.1) ...
Purging configuration files for postgresql-16 (16.9-0ubuntu0.24.04.1) ...
Dropping cluster main...
Purging configuration files for postgresql-common (257build1.1) ...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages will be REMOVED:
  libcommon-sense-perl* libjson-perl* libjson-xs-perl* libllvm17t64* libpq5* libtypes-serialiser-perl* ssl-cert*
0 upgraded, 0 newly installed, 7 to remove and 0 not upgraded.
After this operation, 125 MB disk space will be freed.
(Reading database ... 138274 files and directories currently installed.)
Removing libjson-xs-perl (4.030-2build3) ...
Removing libtypes-serialiser-perl (1.01-1) ...
Removing libcommon-sense-perl:amd64 (3.75-3build3) ...
Removing libjson-perl (4.10000-1) ...
Removing libllvm17t64:amd64 (1:17.0.6-9ubuntu1) ...
Removing libpq5:amd64 (16.9-0ubuntu0.24.04.1) ...
Removing ssl-cert (1.1.2ubuntu1) ...
Processing triggers for man-db (2.12.0-4build2) ...
Processing triggers for libc-bin (2.39-0ubuntu8.5) ...
(Reading database ... 138201 files and directories currently installed.)
Purging configuration files for ssl-cert (1.1.2ubuntu1) ...
0
[15:23:35] âœ… Limpeza preventiva concluÃ­da - ambiente limpo para instalaÃ§Ã£o
[15:23:35] ğŸ“¦ Instalando PostgreSQL 16 em ambiente limpo...
Hit:1 https://packages.grafana.com/oss/deb stable InRelease
Hit:2 http://security.ubuntu.com/ubuntu noble-security InRelease
Hit:3 http://archive.ubuntu.com/ubuntu noble InRelease
Hit:4 http://archive.ubuntu.com/ubuntu noble-updates InRelease
Hit:5 http://archive.ubuntu.com/ubuntu noble-backports InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  libcommon-sense-perl libjson-perl libjson-xs-perl libllvm17t64 libpq5 libtypes-serialiser-perl postgresql-client-16 postgresql-client-common postgresql-common ssl-cert
Suggested packages:
  postgresql-doc-16
The following NEW packages will be installed:
  libcommon-sense-perl libjson-perl libjson-xs-perl libllvm17t64 libpq5 libtypes-serialiser-perl postgresql-16 postgresql-client-16 postgresql-client-common postgresql-common postgresql-contrib ssl-cert
0 upgraded, 12 newly installed, 0 to remove and 0 not upgraded.
Need to get 0 B/43.6 MB of archives.
After this operation, 175 MB of additional disk space will be used.
Preconfiguring packages ...
Selecting previously unselected package libjson-perl.
(Reading database ... 138201 files and directories currently installed.)
Preparing to unpack .../00-libjson-perl_4.10000-1_all.deb ...
Unpacking libjson-perl (4.10000-1) ...
Selecting previously unselected package postgresql-client-common.
Preparing to unpack .../01-postgresql-client-common_257build1.1_all.deb ...
Unpacking postgresql-client-common (257build1.1) ...
Selecting previously unselected package ssl-cert.
Preparing to unpack .../02-ssl-cert_1.1.2ubuntu1_all.deb ...
Unpacking ssl-cert (1.1.2ubuntu1) ...
Selecting previously unselected package postgresql-common.
Preparing to unpack .../03-postgresql-common_257build1.1_all.deb ...
Adding 'diversion of /usr/bin/pg_config to /usr/bin/pg_config.libpq-dev by postgresql-common'
Unpacking postgresql-common (257build1.1) ...
Selecting previously unselected package libcommon-sense-perl:amd64.
Preparing to unpack .../04-libcommon-sense-perl_3.75-3build3_amd64.deb ...
Unpacking libcommon-sense-perl:amd64 (3.75-3build3) ...
Selecting previously unselected package libtypes-serialiser-perl.
Preparing to unpack .../05-libtypes-serialiser-perl_1.01-1_all.deb ...
Unpacking libtypes-serialiser-perl (1.01-1) ...
Selecting previously unselected package libjson-xs-perl.
Preparing to unpack .../06-libjson-xs-perl_4.030-2build3_amd64.deb ...
Unpacking libjson-xs-perl (4.030-2build3) ...
Selecting previously unselected package libllvm17t64:amd64.
Preparing to unpack .../07-libllvm17t64_1%3a17.0.6-9ubuntu1_amd64.deb ...
Unpacking libllvm17t64:amd64 (1:17.0.6-9ubuntu1) ...
Selecting previously unselected package libpq5:amd64.
Preparing to unpack .../08-libpq5_16.9-0ubuntu0.24.04.1_amd64.deb ...
Unpacking libpq5:amd64 (16.9-0ubuntu0.24.04.1) ...
Selecting previously unselected package postgresql-client-16.
Preparing to unpack .../09-postgresql-client-16_16.9-0ubuntu0.24.04.1_amd64.deb ...
Unpacking postgresql-client-16 (16.9-0ubuntu0.24.04.1) ...
Selecting previously unselected package postgresql-16.
Preparing to unpack .../10-postgresql-16_16.9-0ubuntu0.24.04.1_amd64.deb ...
Unpacking postgresql-16 (16.9-0ubuntu0.24.04.1) ...
Selecting previously unselected package postgresql-contrib.
Preparing to unpack .../11-postgresql-contrib_16+257build1.1_all.deb ...
Unpacking postgresql-contrib (16+257build1.1) ...
Setting up postgresql-client-common (257build1.1) ...
Setting up libpq5:amd64 (16.9-0ubuntu0.24.04.1) ...
Setting up libcommon-sense-perl:amd64 (3.75-3build3) ...
Setting up libllvm17t64:amd64 (1:17.0.6-9ubuntu1) ...
Setting up ssl-cert (1.1.2ubuntu1) ...
Created symlink /etc/systemd/system/multi-user.target.wants/ssl-cert.service â†’ /usr/lib/systemd/system/ssl-cert.service.
Setting up libtypes-serialiser-perl (1.01-1) ...
Setting up libjson-perl (4.10000-1) ...
Setting up libjson-xs-perl (4.030-2build3) ...
Setting up postgresql-client-16 (16.9-0ubuntu0.24.04.1) ...
update-alternatives: using /usr/share/postgresql/16/man/man1/psql.1.gz to provide /usr/share/man/man1/psql.1.gz (psql.1.gz) in auto mode
Setting up postgresql-common (257build1.1) ...

Creating config file /etc/postgresql-common/createcluster.conf with new version
Building PostgreSQL dictionaries from installed myspell/hunspell packages...
Removing obsolete dictionary files:
Created symlink /etc/systemd/system/multi-user.target.wants/postgresql.service â†’ /usr/lib/systemd/system/postgresql.service.
Setting up postgresql-16 (16.9-0ubuntu0.24.04.1) ...
Creating new PostgreSQL cluster 16/main ...
/usr/lib/postgresql/16/bin/initdb -D /var/lib/postgresql/16/main --auth-local peer --auth-host scram-sha-256 --no-instructions
The files belonging to this database system will be owned by user "postgres".
This user must also own the server process.

The database cluster will be initialized with locale "en_US.UTF-8".
The default database encoding has accordingly been set to "UTF8".
The default text search configuration will be set to "english".

Data page checksums are disabled.

fixing permissions on existing directory /var/lib/postgresql/16/main ... ok
creating subdirectories ... ok
selecting dynamic shared memory implementation ... posix
selecting default max_connections ... 100
selecting default shared_buffers ... 128MB
selecting default time zone ... Etc/UTC
creating configuration files ... ok
running bootstrap script ... ok
performing post-bootstrap initialization ... ok
syncing data to disk ... ok
Setting up postgresql-contrib (16+257build1.1) ...
Processing triggers for man-db (2.12.0-4build2) ...
Processing triggers for libc-bin (2.39-0ubuntu8.5) ...
Scanning processes...
Scanning candidates...
Scanning linux images...

Pending kernel upgrade!
Running kernel version:
  6.8.0-41-generic
Diagnostics:
  The currently running kernel version is not the expected kernel version 6.8.0-78-generic.

Restarting the system to load the new kernel will not be handled automatically, so you should consider rebooting.

Restarting services...

Service restarts being deferred:
 /etc/needrestart/restart.d/dbus.service
 systemctl restart getty@tty1.service
 systemctl restart systemd-logind.service
 systemctl restart unattended-upgrades.service

No containers need to be restarted.

No user sessions are running outdated binaries.

No VM guests are running outdated hypervisor (qemu) binaries on this host.
Synchronizing state of postgresql.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.
Executing: /usr/lib/systemd/systemd-sysv-install enable postgresql
[15:23:53] âœ… PostgreSQL configurado e iniciado com sucesso
[15:23:53] ğŸ—„ï¸ Configurando usuÃ¡rio e banco de dados...
 pg_terminate_backend
----------------------
(0 rows)

NOTICE:  database "samureye_db" does not exist, skipping
DROP DATABASE
NOTICE:  role "samureye" does not exist, skipping
DROP ROLE
CREATE ROLE
CREATE DATABASE
GRANT
CREATE EXTENSION
CREATE EXTENSION
GRANT
[15:23:53] âœ… PostgreSQL configurado com sucesso
[15:23:53] ğŸ—„ï¸ Criando estrutura do banco de dados...
CREATE TYPE
CREATE TYPE
CREATE TYPE
CREATE TYPE
CREATE TYPE
CREATE TYPE
CREATE TABLE
CREATE INDEX
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
INSERT 0 2
INSERT 0 1
GRANT
GRANT
GRANT
ALTER DEFAULT PRIVILEGES
ALTER DEFAULT PRIVILEGES
[15:23:58] âœ… PostgreSQL configurado e iniciado com sucesso
[15:23:58] ğŸ” Testando conectividade PostgreSQL...
[15:23:58] WARNING: âš ï¸ Problema na conexÃ£o PostgreSQL - todas as tentativas falharam
[15:23:58] PostgreSQL configurado e banco samureye_db criado
[15:23:58] ğŸ“Š Instalando Grafana...
File '/usr/share/keyrings/grafana.gpg' exists. Overwrite? (y/N) y
Hit:1 https://packages.grafana.com/oss/deb stable InRelease
Hit:2 http://archive.ubuntu.com/ubuntu noble InRelease
Hit:3 http://security.ubuntu.com/ubuntu noble-security InRelease
Hit:4 http://archive.ubuntu.com/ubuntu noble-updates InRelease
Hit:5 http://archive.ubuntu.com/ubuntu noble-backports InRelease
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
All packages are up to date.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
grafana is already the newest version (12.1.1).
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Synchronizing state of grafana-server.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.
Executing: /usr/lib/systemd/systemd-sysv-install disable grafana-server
Removed "/etc/systemd/system/multi-user.target.wants/grafana-server.service".
Failed to reset failed state of unit grafana-server.service: Unit grafana-server.service not loaded.
[15:24:13] WARNING: Grafana nÃ£o consegue escrever em /opt/data/grafana, usando configuraÃ§Ã£o padrÃ£o
[15:24:13] Usando configuraÃ§Ã£o padrÃ£o do Grafana
Failed to reset failed state of unit grafana-server.service: Unit grafana-server.service not loaded.
Synchronizing state of grafana-server.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.
Executing: /usr/lib/systemd/systemd-sysv-install enable grafana-server
Created symlink /etc/systemd/system/multi-user.target.wants/grafana-server.service â†’ /usr/lib/systemd/system/grafana-server.service.
[15:24:15] Iniciando Grafana (aguarde 15 segundos)...
[15:24:30] âœ… Grafana configurado e iniciado com sucesso
[15:24:30] ğŸ—„ï¸ Instalando MinIO (backup local)...
Removed "/etc/systemd/system/multi-user.target.wants/minio.service".
--2025-08-26 15:24:38--  https://dl.min.io/server/minio/release/linux-amd64/minio
Resolving dl.min.io (dl.min.io)... 178.128.69.202, 138.68.11.125
Connecting to dl.min.io (dl.min.io)|178.128.69.202|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 110780600 (106M) [application/octet-stream]
Saving to: â€˜/usr/local/bin/minioâ€™

/usr/local/bin/minio                                 100%[======================================================================================================================>] 105.65M  4.57MB/s    in 2m 58s

2025-08-26 15:27:37 (606 KB/s) - â€˜/usr/local/bin/minioâ€™ saved [110780600/110780600]

usermod: no changes
Created MinIO structure in /var/lib/minio
[15:27:37] Estrutura MinIO criada:
total 16
drwxr-xr-x  4 minio minio 4096 Aug 26 15:27 .
drwxr-xr-x 50 root  root  4096 Aug 26 15:27 ..
drwxrwxr-x  2 minio minio 4096 Aug 26 15:27 config
drwxrwxr-x  2 minio minio 4096 Aug 26 15:27 data
[15:27:37] âœ… DiretÃ³rio MinIO configurado
[15:27:37] Testando acesso MinIO ao diretÃ³rio...
Created symlink /etc/systemd/system/multi-user.target.wants/minio.service â†’ /etc/systemd/system/minio.service.
[15:27:37] Iniciando MinIO...
[15:27:45] âœ… MinIO configurado e iniciado com sucesso
[15:27:45] ğŸ”§ Configurando variÃ¡veis de ambiente...
[15:27:45] ConfiguraÃ§Ã£o de ambiente criada
[15:27:45] ğŸ“ Criando scripts de teste...
[15:27:45] Scripts de teste criados
[15:27:45] â° Configurando cron para backups...
[15:27:45] Cron jobs configurados
[15:27:45] ğŸ“‹ Configurando rotaÃ§Ã£o de logs...
[15:27:45] RotaÃ§Ã£o de logs configurada
[15:27:45] ğŸ¯ Finalizando instalaÃ§Ã£o...
[15:27:45] âœ… postgresql: Ativo
[15:27:45] âœ… redis-server: Ativo
[15:27:45] âœ… grafana-server: Ativo
[15:27:45] âœ… minio: Ativo

============================================================================
ğŸ‰ INSTALAÃ‡ÃƒO vlxsam03 CONCLUÃDA
============================================================================

ğŸ“Š SERVIÃ‡OS INSTALADOS:
  â€¢ PostgreSQL (Database): 172.24.1.153:5432
  â€¢ Redis (Cache/Sessions): 172.24.1.153:6379
  â€¢ Grafana (Monitoring): http://172.24.1.153:3000
  â€¢ MinIO (Backup): http://172.24.1.153:9000

ğŸ”‘ CREDENCIAIS PADRÃƒO:
  â€¢ PostgreSQL: samureye/SamurEye2024DB! (banco: samureye_db)
  â€¢ Redis: senha 'SamurEye2024Redis!'
  â€¢ Grafana: admin/SamurEye2024!
  â€¢ MinIO: admin/SamurEye2024!

âš ï¸ PRÃ“XIMOS PASSOS:
  1. Configurar object storage no vlxsam02
  2. Executar testes: /opt/samureye/scripts/health-check.sh
  3. Verificar conectividade PostgreSQL: /opt/samureye/scripts/test-postgres-connection.sh
  4. Para reset completo PostgreSQL (emergencial): samureye-reset-postgres

ğŸ“ DIRETÃ“RIOS IMPORTANTES:
  â€¢ Dados: /opt/data
  â€¢ Backups: /opt/backup
  â€¢ Scripts: /opt/samureye/scripts
  â€¢ ConfiguraÃ§Ã£o: /etc/samureye
  â€¢ Logs: /var/log/samureye

============================================================================
[15:27:45] âœ… InstalaÃ§Ã£o vlxsam03 concluÃ­da com sucesso!
root@vlxsam03:~# /opt/samureye/scripts/health-check.sh
=== SAMUREYE vlxsam03 HEALTH CHECK ===
Data: Tue Aug 26 03:27:51 PM UTC 2025
Servidor: vlxsam03 (172.24.1.153)

ğŸ”´ REDIS:
âœ… Redis: Online
Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe.
   MemÃ³ria: 501.59K

ğŸ“Š GRAFANA:
âœ… Grafana: Online

ğŸ—„ï¸ MINIO (Backup):
âœ… MinIO: Online

ğŸŒ CONECTIVIDADE EXTERNA:
âŒ Neon Database: Desconectado
âœ… Google Cloud Storage: Conectado

ğŸ’» SISTEMA:
CPU: 2.4%
MemÃ³ria: 11.1%
Disco: 9%

=== FIM DO HEALTH CHECK ===
root@vlxsam03:~# /opt/samureye/scripts/test-postgres-connection.sh
[15:27:56] ğŸ˜ Testando conectividade PostgreSQL...
[15:27:56] Testando conexÃ£o com banco samureye_db...
[15:27:57] ERROR: âŒ Falha na conexÃ£o PostgreSQL - todas as tentativas falharam
root@vlxsam03:~#