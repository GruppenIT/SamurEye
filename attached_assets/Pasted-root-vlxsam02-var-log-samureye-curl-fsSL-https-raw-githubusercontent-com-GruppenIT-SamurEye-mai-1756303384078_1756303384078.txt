root@vlxsam02:/var/log/samureye# curl -fsSL https://raw.githubusercontent.com/GruppenIT/SamurEye/main/docs/deployment/vlxsam02/test-pg-connection.sh | sudo bash
=== Teste de Conectividade PostgreSQL vlxsam02 -> vlxsam03 ===
ğŸ“Š Testando com credenciais:
   Host: 172.24.1.153:5432
   Banco: samureye_prod
   UsuÃ¡rio: samureye
   Senha: [OMITIDA]

â„¹ï¸  TESTE 1: Conectividade de rede...
âœ… Porta PostgreSQL acessÃ­vel
â„¹ï¸  TESTE 2: AutenticaÃ§Ã£o PostgreSQL...
âœ… Conectividade PostgreSQL funcionando!

â„¹ï¸  InformaÃ§Ãµes da conexÃ£o:
 current_user | current_database |                                                               version
 samureye     | samureye_prod    | PostgreSQL 16.9 (Ubuntu 16.9-0ubuntu0.24.04.1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0, 64-bit

â„¹ï¸  TESTE 3: Verificando permissÃµes...
âœ… PermissÃµes de escrita funcionando
â„¹ï¸  TESTE 4: Verificando configuraÃ§Ã£o local...
âœ… Arquivo .env encontrado: /etc/samureye/.env
âœ… DATABASE_URL configurada corretamente
â„¹ï¸  DATABASE_URL: postgresql://samureye:SamurEye2024!@172.24.1.153:5432/samureye_prod
âœ… URL aponta para o servidor correto
â„¹ï¸  TESTE 5: Verificando aplicaÃ§Ã£o SamurEye...
âœ… ServiÃ§o samureye-app ativo
âš ï¸  Endpoint retorna 401 - problema de autenticaÃ§Ã£o da aplicaÃ§Ã£o

â„¹ï¸  RESUMO DAS RECOMENDAÃ‡Ã•ES:

â„¹ï¸  Para corrigir problemas PostgreSQL (mais comum):
   # No vlxsam03:
   curl -fsSL https://raw.githubusercontent.com/GruppenIT/SamurEye/main/docs/deployment/vlxsam03/fix-pg-user.sh | sudo bash

â„¹ï¸  Para diagnÃ³stico completo:
   # No vlxsam02:
   curl -fsSL https://raw.githubusercontent.com/GruppenIT/SamurEye/main/docs/deployment/vlxsam02/diagnose-pg-connection.sh | sudo bash

â„¹ï¸  Teste concluÃ­do
root@vlxsam02:/var/log/samureye# curl -fsSL https://raw.githubusercontent.com/GruppenIT/SamurEye/main/docs/deployment/vlxsam02/diagnose-pg-connection.sh | sudo bash
=== DiagnÃ³stico de Conectividade PostgreSQL vlxsam02 -> vlxsam03 ===
ğŸš€ Iniciando diagnÃ³stico de conectividade PostgreSQL
ğŸ“… Wed Aug 27 11:03:22 AM -03 2025
ğŸ–¥ï¸  vlxsam02 -> vlxsam03 (172.24.1.153:5432)

ğŸŒ TESTE 1: Conectividade de Rede
================================
âœ… Ping para vlxsam03 (172.24.1.153) funcionando
âœ… Porta PostgreSQL (5432) acessÃ­vel

ğŸ˜ TESTE 2: Conectividade PostgreSQL
===================================
â„¹ï¸  Testando conexÃ£o PostgreSQL com psql...
âœ… ConexÃ£o PostgreSQL funcionando

ğŸ”§ TESTE 3: VariÃ¡veis de Ambiente
================================
âœ… Arquivo .env encontrado
âœ… DATABASE_URL configurada
â„¹ï¸  DATABASE_URL: postgresql://samureye:SamurEye2024!@172.24.1.153:5432/samureye_prod
âœ… DATABASE_URL aponta para vlxsam03

ğŸ”§ TESTE 4: Status do ServiÃ§o SamurEye
=====================================
âœ… ServiÃ§o samureye-app ativo
â„¹ï¸  Ãšltimos logs do serviÃ§o:
âœ… Nenhum erro recente nos logs

ğŸŒ TESTE 5: Conectividade HTTP da AplicaÃ§Ã£o
===========================================
âœ… Endpoint /api/health respondendo
âš ï¸  Endpoint /api/admin/stats retornou cÃ³digo: 401

ğŸ“Š RESUMO DOS TESTES
===================
Testes aprovados: 5/5
âœ… Todos os testes passaram - sistema funcionando!

â„¹ï¸  DiagnÃ³stico concluÃ­do
root@vlxsam02:/var/log/samureye#