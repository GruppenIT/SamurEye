root@vlxsam04:~# curl -fsSL https://raw.githubusercontent.com/GruppenIT/SamurEye/main/docs/deployment/vlxsam04/fix-token-issue-definitive.sh | bash
ğŸ¯ CORREÃ‡ÃƒO DEFINITIVA - TOKEN ISSUE
====================================
[11:25:44] ğŸ¯ Implementando correÃ§Ã£o definitiva para vlxsam04...

ğŸ›‘ 1. PARANDO SERVIÃ‡O:
=====================

ğŸ”§ 2. IMPLEMENTANDO SOLUÃ‡ÃƒO ROBUSTA:
===================================
[11:25:46] ğŸ“„ Criando script de registro definitivo...
[11:25:46] âœ… Script de registro definitivo criado

ğŸ”§ 3. ATUALIZANDO HEARTBEAT PARA FUNCIONAR COM QUALQUER TOKEN:
==============================================================
[11:25:46] ğŸ Criando heartbeat robusto...
[11:25:46] âœ… Heartbeat definitivo criado

ğŸ”§ 4. CONFIGURANDO ARQUIVO .ENV ROBUSTO:
========================================

ğŸš€ 5. REINICIANDO SERVIÃ‡O:
==========================
[11:25:50] âœ… ServiÃ§o estÃ¡ rodando

ğŸ¯ CORREÃ‡ÃƒO DEFINITIVA APLICADA!
================================

âœ… COMPONENTES INSTALADOS:
   ğŸ“„ Script de registro definitivo: /opt/samureye/collector/scripts/register-collector-definitive.sh
   ğŸ Heartbeat robusto: /opt/samureye/collector/heartbeat.py
   ğŸ“ ConfiguraÃ§Ã£o: /etc/samureye-collector/.env
   ğŸ¤– ServiÃ§o: samureye-collector

ğŸš€ COMO USAR:
============
1. Registrar collector (sempre funciona):
   /opt/samureye/collector/scripts/register-collector-definitive.sh gruppen-it <ENROLLMENT-TOKEN>

2. Verificar status:
   systemctl status samureye-collector

3. Monitorar logs:
   tail -f /var/log/samureye-collector/heartbeat.log

[11:25:50] âœ… Problema dos cÃ­rculos RESOLVIDO definitivamente!
root@vlxsam04:~# 1836c881-30e1-4f45-8ecd-e004a07114b6^C
root@vlxsam04:~# 1836c881-30e1-4f45-8ecd-e004a07114b6^C
root@vlxsam04:~# 1836c881-30e1-4f45-8ecd-e004a07114b6^C
root@vlxsam04:~# /opt/samureye/collector/scripts/register-collector-definitive.sh gruppen-it 1836c881-30e1-4f45-8ecd-e004a07114b6
ğŸ¯ REGISTRO DEFINITIVO - vlxsam04
=================================

ğŸ“¤ ESTRATÃ‰GIA 1: Registro via API...
âœ… API retornou sucesso
âœ… Token extraÃ­do da API: 0f61f03f...7700d92e

ğŸ’¾ SALVANDO TOKEN...
âœ… Token salvo com sucesso

ğŸš€ REINICIANDO SERVIÃ‡O...
âœ… ServiÃ§o ativo

ğŸ“ Verificando logs iniciais...
Ãšltimos logs:
   2025-09-04 11:26:41,987 - INFO - ConfiguraÃ§Ã£o carregada - ID: vlxsam04
   2025-09-04 11:26:41,987 - INFO - Iniciando heartbeat definitivo...
   2025-09-04 11:26:41,988 - INFO - ConfiguraÃ§Ã£o carregada - ID: vlxsam04
   2025-09-04 11:26:43,065 - WARNING - Heartbeat retornou status 400: {"message":"collector_id required"}
   2025-09-04 11:26:43,066 - WARNING - Falha #1 no heartbeat

ğŸ‰ SUCESSO! Collector funcionando sem erro 401

ğŸ¯ REGISTRO DEFINITIVO CONCLUÃDO!
=================================
â€¢ Token configurado: 0f61f03f...7700d92e
â€¢ Arquivo: /etc/samureye-collector/.env
â€¢ ServiÃ§o: samureye-collector
â€¢ Status: active
root@vlxsam04:~# tail -f /var/log/samureye-collector/collector.log
2025-09-04 11:25:47,229 - WARNING - Falha #1 no heartbeat
2025-09-04 11:26:17,229 - WARNING - Token nÃ£o configurado - heartbeat serÃ¡ enviado sem autenticaÃ§Ã£o
2025-09-04 11:26:17,229 - WARNING - Falha #2 no heartbeat
2025-09-04 11:26:41,987 - INFO - ConfiguraÃ§Ã£o carregada - ID: vlxsam04
2025-09-04 11:26:41,987 - INFO - Iniciando heartbeat definitivo...
2025-09-04 11:26:41,988 - INFO - ConfiguraÃ§Ã£o carregada - ID: vlxsam04
/usr/lib/python3/dist-packages/urllib3/connectionpool.py:1100: InsecureRequestWarning: Unverified HTTPS request is being made to host 'api.samureye.com.br'. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#tls-warnings
  warnings.warn(
2025-09-04 11:26:43,065 - WARNING - Heartbeat retornou status 400: {"message":"collector_id required"}
2025-09-04 11:26:43,066 - WARNING - Falha #1 no heartbeat
/usr/lib/python3/dist-packages/urllib3/connectionpool.py:1100: InsecureRequestWarning: Unverified HTTPS request is being made to host 'api.samureye.com.br'. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#tls-warnings
  warnings.warn(
2025-09-04 11:27:14,121 - WARNING - Heartbeat retornou status 400: {"message":"collector_id required"}
2025-09-04 11:27:14,122 - WARNING - Falha #2 no heartbeat
^C
root@vlxsam04:~#