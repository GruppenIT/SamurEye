root@vlxsam02:~# curl -fsSL https://raw.githubusercontent.com/GruppenIT/SamurEye/refs/heads/main/docs/deployment/vlxsam02/fix-conditional-auth.sh | bash

ğŸ”§ CORREÃ‡ÃƒO PROBLEMA AUTENTICAÃ‡ÃƒO CONDICIONAL
============================================

[16:35:11] INFO: Removendo lÃ³gica que bypassa autenticaÃ§Ã£o quando hÃ¡ usuÃ¡rios no banco
[16:35:11] ğŸ“ Criando backup do routes.ts atual...
[16:35:11] âœ… Backup criado
[16:35:11] ğŸ”§ Aplicando correÃ§Ã£o de autenticaÃ§Ã£o condicional...
ğŸ”§ Corrigindo problema de autenticaÃ§Ã£o condicional...
âœ… Arquivo .env corrigido
âš ï¸ Middleware nÃ£o encontrado - adicionando novo
âœ… Middleware adicionado
âœ… Rota /api/user corrigida
âœ… CorreÃ§Ã£o de autenticaÃ§Ã£o condicional aplicada com sucesso
[16:35:11] ğŸ§¹ Limpando sessÃµes existentes para forÃ§ar novo login...
[16:35:11] ğŸ”„ Rebuilding aplicaÃ§Ã£o com correÃ§Ã£o...
[16:35:19] WARNING: âš ï¸ Build apresentou warnings, mas pode estar OK
[16:35:19] ğŸ”„ Reiniciando serviÃ§o samureye-app...
[16:35:19] âœ… ServiÃ§o reiniciado
[16:35:19] â³ Aguardando aplicaÃ§Ã£o ficar disponÃ­vel...
.[16:35:21] âœ… AplicaÃ§Ã£o online na porta 5000

[16:35:21] ğŸ§ª Testando correÃ§Ã£o aplicada...
[16:35:21] ERROR: âŒ Problema persiste - /api/user ainda retorna 200
[16:35:21] WARNING: âš ï¸ Verifique se middleware foi aplicado corretamente
{"id":"onpremise-user","email":"tenant@onpremise.local","name":"On-Premise Tenant User","isSocUser":false,"isActive":true,"tenants":[{"tenantId":"3ad0d4ee-e6fa-4690-af4b-8993dd412305","role":"tenant_admin","tenant":{"id":"3ad0d4ee-e6fa-4690-af4b-8993dd412305","name":"Gruppen it","slug":"gruppen-it","description":"","logoUrl":null,"settings":null,"isActive":true,"createdAt":"2025-09-03T19:29:02.768Z","updatedAt":"2025-09-03T19:29:02.768Z"}}],"currentTenant":{"id":"3ad0d4ee-e6fa-4690-af4b-8993dd412305","name":"Gruppen it","slug":"gruppen-it","description":"","logoUrl":null,"settings":null,"isActive":true,"createdAt":"2025-09-03T19:29:02.768Z","updatedAt":"2025-09-03T19:29:02.768Z"}}
[16:35:21] ğŸ¯ CORREÃ‡ÃƒO DE AUTENTICAÃ‡ÃƒO CONDICIONAL CONCLUÃDA
=================================================

[16:35:21] ERROR: âŒ CORREÃ‡ÃƒO PODE TER FALHADO
   â€¢ Execute diagnÃ³stico para verificar:
   curl -fsSL https://raw.githubusercontent.com/GruppenIT/SamurEye/main/docs/deployment/vlxsam02/diagnose-conditional-auth.sh | bash

[16:35:21] ğŸ”§ CorreÃ§Ã£o de autenticaÃ§Ã£o condicional finalizada
root@vlxsam02:~#